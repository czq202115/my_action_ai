name: Docker Action test

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2
    - name: 下载模型
      run: |
        sudo apt install git git-lfs wget -y
       
        cd $GITHUB_WORKSPACE
        mkdir models
        cd $GITHUB_WORKSPACE/models
        git lfs install
        git clone https://huggingface.co/runfuture/MiniCPM-2B-dpo-fp16-gguf --depth=1
        ls
        echo "下载完成"
    
    - name: Run Docker container
      run: |
        
        wget https://github.com/kschen202115/build_llama.cpp_docker/releases/download/0.0.1/image.tar
        docker load -i image.tar

        cd $GITHUB_WORKSPACE
        sudo chmod +x run_docker.sh
        sudo bash run_docker.sh
        sudo docker ps -a
